"use strict";(self.webpackChunkcode_groundlight_ai=self.webpackChunkcode_groundlight_ai||[]).push([[9287],{4650:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guide/async-queries","title":"Using Asynchronous Queries","description":"Groundlight provides a simple interface for submitting asynchronous queries. This is useful for situations in which the thread or process or machine submitting image queries is not the same thread or machine that will be retrieving and using the results.","source":"@site/docs/guide/7-async-queries.md","sourceDirName":"guide","slug":"/guide/async-queries","permalink":"/python-sdk/docs/guide/async-queries","draft":false,"unlisted":false,"editUrl":"https://github.com/groundlight/python-sdk/tree/main/docs/docs/guide/7-async-queries.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Handling Errors","permalink":"/python-sdk/docs/guide/handling-errors"},"next":{"title":"Processing Images on the Edge","permalink":"/python-sdk/docs/guide/edge"}}');var i=t(4848),s=t(8453);const a={},o="Using Asynchronous Queries",u={},d=[{value:"Setup Submitting Machine",id:"setup-submitting-machine",level:2},{value:"Setup Retrieving Machine",id:"setup-retrieving-machine",level:2},{value:"Important Considerations",id:"important-considerations",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"using-asynchronous-queries",children:"Using Asynchronous Queries"})}),"\n",(0,i.jsx)(n.p,{children:"Groundlight provides a simple interface for submitting asynchronous queries. This is useful for situations in which the thread or process or machine submitting image queries is not the same thread or machine that will be retrieving and using the results."}),"\n",(0,i.jsxs)(n.p,{children:["For example, you might have a forward deployed robot or camera that submits image queries to Groundlight, and a separate server that retrieves the results and takes action based on them. We will refer to these two machines as the ",(0,i.jsx)(n.strong,{children:"submitting machine"})," and the ",(0,i.jsx)(n.strong,{children:"retrieving machine"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"setup-submitting-machine",children:"Setup Submitting Machine"}),"\n",(0,i.jsxs)(n.p,{children:["On the ",(0,i.jsx)(n.strong,{children:"submitting machine"}),", you will need to install the Groundlight Python SDK. Then you can submit image queries asynchronously using the ",(0,i.jsx)(n.code,{children:"ask_async"})," interface (read the full documentation ",(0,i.jsx)(n.a,{href:"pathname:///python-sdk/api-reference-docs/#groundlight.client.Groundlight.ask_async",children:"here"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ask_async"})," submits your query and immediately returns, without waiting for an answer. This minimizes the time your program spends interacting with Groundlight. Consequently, the ",(0,i.jsx)(n.code,{children:"ImageQuery"})," object returned by ",(0,i.jsx)(n.code,{children:"ask_async"})," does not contain a ",(0,i.jsx)(n.code,{children:"result"})," (the ",(0,i.jsx)(n.code,{children:"result"})," field will be ",(0,i.jsx)(n.code,{children:"None"}),"). This is suitable for scenarios where the ",(0,i.jsx)(n.strong,{children:"submitting machine"})," does not need the result. Instead, the ",(0,i.jsx)(n.strong,{children:"submitting machine"})," only needs to share the ",(0,i.jsx)(n.code,{children:"ImageQuery.id"})," with the ",(0,i.jsx)(n.strong,{children:"retrieving machine"}),". This can be done through a database, message queue, or another method. In this example, we assume you are using a database to save the ",(0,i.jsx)(n.code,{children:"ImageQuery.id"})," with ",(0,i.jsx)(n.code,{children:"db.save(image_query.id)"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:"notest",children:"from time import sleep\nfrom framegrab import FrameGrabber\nfrom groundlight import Groundlight\n\n# Create a FrameGrabber for a generic USB camera (e.g., a webcam)\nconfig = {'input_type': 'generic_usb'}\ngrabber = FrameGrabber.create_grabber(config)\n\ndetector = gl.get_or_create_detector(name=\"your_detector_name\", query=\"your_query\")\n\nwhile True:\n    image = grabber.grab()\n\n    # highlight-start\n    image_query = gl.ask_async(detector=detector, image=image)\n    db.save(image_query.id)  # Save the image_query.id to a database for the retrieving machine to use\n    # highlight-end\n\n    sleep(10) # Sleep for 10 seconds before grabbing the next image\n\ngrabber.release()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"setup-retrieving-machine",children:"Setup Retrieving Machine"}),"\n",(0,i.jsxs)(n.p,{children:["On the ",(0,i.jsx)(n.strong,{children:"retrieving machine"}),", ensure the Groundlight Python SDK is installed. You can then use the ",(0,i.jsx)(n.code,{children:"get_image_query"})," method to fetch results of image queries submitted by the ",(0,i.jsx)(n.strong,{children:"submitting machine"}),". The ",(0,i.jsx)(n.strong,{children:"retrieving machine"})," can utilize the ",(0,i.jsx)(n.code,{children:"ImageQuery.result"})," to perform actions based on the application's requirements. In this example, we assume your application retrieves the next image query ID to process from a database using ",(0,i.jsx)(n.code,{children:"db.get_next_image_query_id()"}),". This function should return ",(0,i.jsx)(n.code,{children:"None"})," when all ",(0,i.jsx)(n.code,{children:"ImageQuery"})," entries have been processed."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:"notest",children:"from groundlight import Groundlight\n\ndetector = gl.get_or_create_detector(name=\"your_detector_name\", query=\"your_query\")\n\nimage_query_id = db.get_next_image_query_id()\n\nwhile image_query_id is not None:\n    # highlight-start\n    image_query = gl.get_image_query(id=image_query_id)  # retrieve the image query from Groundlight\n    # highlight-end\n    result = image_query.result\n\n    # take action based on the result of the image query\n    if result.label == 'YES':\n        pass # TODO: do something based on your application\n    elif result.label == 'NO':\n        pass # TODO: do something based on your application\n    elif result.label == 'UNCLEAR':\n        pass # TODO: do something based on your application\n\n    # update image_query_id for next iteration of the loop\n    image_query_id = db.get_next_image_query_id()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"important-considerations",children:"Important Considerations"}),"\n",(0,i.jsxs)(n.p,{children:["When you submit an image query asynchronously, ML prediction on your query is ",(0,i.jsx)(n.strong,{children:"not"})," instant. So attempting to retrieve the result immediately after submitting an async query will likely result in an ",(0,i.jsx)(n.code,{children:"UNCLEAR"})," result as Groundlight is still processing your query. Instead, if your code needs a ",(0,i.jsx)(n.code,{children:"result"})," synchronously we recommend using one of our methods with a polling mechanism to retrieve the result (e.g. ",(0,i.jsx)(n.code,{children:"ask_confident"}),"). You can see all of the interfaces available in the documentation ",(0,i.jsx)(n.a,{href:"pathname:///python-sdk/api-reference-docs/#groundlight.client.Groundlight",children:"here"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:"notest",children:'from PIL import Image\nfrom groundlight import Groundlight\n\ndetector = gl.get_or_create_detector(name="your_detector_name", query="your_query")\nimage = Image.open("/path/to/your/image.jpg")\n\nimage_query = gl.ask_async(detector=detector, image=image)  # Submit async query to Groundlight\nassert image_query.result is None  # IQs returned from `ask_async` will not have a result\n\nimage_query = gl.get_image_query(id=image_query.id)  # Immediately retrieve the image query from Groundlight\nresult = image_query.result  # This may be \'UNCLEAR\' as Groundlight continues to process the query\n\nimage_query = gl.wait_for_confident_result(id=image_query.id)  # Poll for a confident result from Groundlight\nresult = image_query.result\n'})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);