"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3201],{8523:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var i=n(5893),r=n(1151);const s={},a="A Quick Example: Live Stream Alert",o={id:"getting-started/streaming",title:"A Quick Example: Live Stream Alert",description:"A quick example to get used to setting up detectors and asking good questions: set up a monitor on a live stream.",source:"@site/docs/getting-started/5-streaming.md",sourceDirName:"getting-started",slug:"/getting-started/streaming",permalink:"/python-sdk/docs/getting-started/streaming",draft:!1,unlisted:!1,editUrl:"https://github.com/groundlight/python-sdk/tree/main/docs/docs/getting-started/5-streaming.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"A Fun Example: Dog-on-Couch Detector",permalink:"/python-sdk/docs/getting-started/dog-on-couch"},next:{title:"Building Applications",permalink:"/python-sdk/docs/building-applications/"}},l={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"Creating the Application",id:"creating-the-application",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"a-quick-example-live-stream-alert",children:"A Quick Example: Live Stream Alert"}),"\n",(0,i.jsx)(t.p,{children:"A quick example to get used to setting up detectors and asking good questions: set up a monitor on a live stream."}),"\n",(0,i.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/docs/installation/",children:"Groundlight SDK"})," with Python 3.7 or higher"]}),"\n",(0,i.jsx)(t.li,{children:"The video ID of a YouTube live stream you'd like to monitor"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(t.p,{children:"Ensure you have Python 3.7 or higher installed, and then install the Groundlight SDK and OpenCV library:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"# MacOS\nbrew install ffmpeg\n\n# Ubuntu/Fedora linux\nsudo apt install -y ffmpeg\n\npip install groundlight pillow ffmpeg yt-dlp typer\n"})}),"\n",(0,i.jsx)(t.h2,{id:"creating-the-application",children:"Creating the Application"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Save this command as a shell script ",(0,i.jsx)(t.code,{children:"get_latest_frame.sh"}),":"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'#!/bin/bash\n\nffmpeg -i "$(yt-dlp -g $1 | head -n 1)" -vframes 1 last.jpg -y\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This will download the most recent frame from a YouTube live stream and save it to a local file ",(0,i.jsx)(t.code,{children:"last.jpg"}),"."]}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsx)(t.li,{children:"Ensure that the script has execute permissions. You can add execute permissions using the following command:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"chmod +x get_latest_frame.sh\n"})}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Log in to the ",(0,i.jsx)(t.a,{href:"https://app.groundlight.ai",children:"Groundlight application"})," and get an ",(0,i.jsx)(t.a,{href:"api-tokens",children:"API Token"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Next, we'll write the Python script for the application."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",metastring:"notest",children:'import os\nimport subprocess\nimport typer\nfrom groundlight import Groundlight\nfrom PIL import Image\n\n\ndef main(*, video_id: str = None, detector_name: str = None, query: str = None, confidence: float = 0.75, wait: int = 60):\n    """\n    Run the script to get the stream\'s last frame as a subprocess, and submit result as an image query to a Groundlight detector\n    :param video_id: Video ID of the YouTube live stream (the URLs have the form https://www.youtube.com/watch?v=<VIDEO_ID>)\n    :param detector_name: Name for your Groundlight detector\n    :param query: Question you want to ask of the stream (we will alert on the answer of NO)\n    """\n    gl = Groundlight()\n    detector = gl.get_or_create_detector(name=detector_name, query=query, confidence_threshold=confidence)\n\n    while True:\n        p = subprocess.run(["./get_latest_frame.sh", video_id])\n        if p.returncode != 0:\n            raise RuntimeError(f"Could not get image from video ID: {video_id}. Process exited with return code {p.returncode}.")\n        \n        image = Image.open("last.jpg").convert("RGB")\n        response = gl.submit_image_query(detector=detector, image=image, wait=wait)\n\n        if response.result.label == "NO":\n            os.system("say \'Alert!\'") # this may not work on all operating systems\n\n\nif __name__ == "__main__":\n    typer.run(main)\n\n'})}),"\n",(0,i.jsxs)(t.ol,{start:"5",children:["\n",(0,i.jsxs)(t.li,{children:["Save the script as ",(0,i.jsx)(t.code,{children:"streaming_alert.py"})," in the same directory as ",(0,i.jsx)(t.code,{children:"get_latest_frame.sh"})," above and run it:"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"python streaming_alert.py --video-id=<VIDEO_ID> --detector-name=<DETECTOR_NAME> --query=<QUERY IN QUOTATION MARKS>\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>a});var i=n(7294);const r={},s=i.createContext(r);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);